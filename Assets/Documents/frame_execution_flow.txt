# System Execution Order Visualization

## Frame-by-Frame Execution Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Unity Frame N                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  SimulationTimeSystem                                       â”‚
â”‚  â”œâ”€ Accumulate Unity deltaTime                             â”‚
â”‚  â”œâ”€ Check if accumulated >= 1/60s                          â”‚
â”‚  â””â”€ If yes, trigger simulation step(s)                     â”‚
â”‚                                                             â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚      â”‚        SIMULATION STEP (Tick)            â”‚          â”‚
â”‚      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚
â”‚      â”‚                                          â”‚          â”‚
â”‚      â”‚  ğŸ® InputProcessingPhase                 â”‚          â”‚
â”‚      â”‚  â””â”€ PlayerInputMovementSystem           â”‚          â”‚
â”‚      â”‚      â€¢ Read input packets               â”‚          â”‚
â”‚      â”‚      â€¢ Convert to velocity changes      â”‚          â”‚
â”‚      â”‚                                          â”‚          â”‚
â”‚      â”‚  âš›ï¸ PhysicsPhase                         â”‚          â”‚
â”‚      â”‚  â”œâ”€ GravitySystem                       â”‚          â”‚
â”‚      â”‚  â”‚   â€¢ Apply gravity to velocity        â”‚          â”‚
â”‚      â”‚  â”‚                                       â”‚          â”‚
â”‚      â”‚  â”œâ”€ SimpleMovementSystem                â”‚          â”‚
â”‚      â”‚  â”‚   â€¢ position += velocity * deltaTime â”‚          â”‚
â”‚      â”‚  â”‚                                       â”‚          â”‚
â”‚      â”‚  â”œâ”€ CollisionDetectionSystem            â”‚          â”‚
â”‚      â”‚  â”‚   â€¢ AABB tests                       â”‚          â”‚
â”‚      â”‚  â”‚   â€¢ Generate collision events        â”‚          â”‚
â”‚      â”‚  â”‚                                       â”‚          â”‚
â”‚      â”‚  â”œâ”€ CollisionResponseSystem             â”‚          â”‚
â”‚      â”‚  â”‚   â€¢ Process collision events         â”‚          â”‚
â”‚      â”‚  â”‚   â€¢ Adjust positions/velocities      â”‚          â”‚
â”‚      â”‚  â”‚                                       â”‚          â”‚
â”‚      â”‚  â””â”€ SimEntityTransformSystem            â”‚          â”‚
â”‚      â”‚      â€¢ Final transform updates          â”‚          â”‚
â”‚      â”‚      â€¢ (Future: hierarchy updates)      â”‚          â”‚
â”‚      â”‚                                          â”‚          â”‚
â”‚      â”‚  ğŸ¯ GameplayPhase                        â”‚          â”‚
â”‚      â”‚  â””â”€ (Future systems)                    â”‚          â”‚
â”‚      â”‚                                          â”‚          â”‚
â”‚      â”‚  ğŸ§¹ CleanupPhase                         â”‚          â”‚
â”‚      â”‚  â””â”€ (Future cleanup)                    â”‚          â”‚
â”‚      â”‚                                          â”‚          â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Through Systems

```
Input Packet
    â†“
PlayerInputMovementSystem
    â†“ (sets velocity)
GravitySystem
    â†“ (modifies velocity)
SimpleMovementSystem
    â†“ (updates position)
CollisionDetectionSystem
    â†“ (creates events)
CollisionResponseSystem
    â†“ (adjusts position/velocity)
SimEntityTransformSystem
    â†“ (final transform)
Rendered Frame
```

## Why This Order Matters

### 1. **Input First**
- Player actions must be processed before physics
- Sets initial velocities for the frame

### 2. **Forces Before Movement**
- Gravity and other forces modify velocity
- Movement integrates final velocity into position

### 3. **Detection Before Response**
- Must know what collided before resolving
- Separation allows for complex collision rules

### 4. **Transform Last**
- All position modifications complete
- Ready for rendering/networking

## Adding New Systems

### Before Adding a System, Ask:
1. **What data does it read?** â†’ Must run AFTER systems that write that data
2. **What data does it write?** â†’ Must run BEFORE systems that read that data
3. **What phase does it belong to?**
   - Input processing? â†’ InputProcessingPhase
   - Physics/movement? â†’ PhysicsPhase
   - Game logic? â†’ GameplayPhase
   - Cleanup? â†’ CleanupPhase

### Example: Adding a Jump System
```csharp
// Needs to:
// - Read input (jump button)
// - Modify velocity (add upward)
// - Run before movement integration

[UpdateInGroup(typeof(PhysicsPhase))]
[UpdateAfter(typeof(PlayerInputMovementSystem))]  // After input
[UpdateBefore(typeof(GravitySystem))]             // Before gravity
public partial struct JumpSystem : ISystem
{
    // Reads: jump input, grounded state
    // Writes: velocity.y
}
```

## Debugging Execution Order

### Method 1: Log in Each System
```csharp
public void OnUpdate(ref SystemState state)
{
    var time = SystemAPI.GetSingleton<SimulationTimeComponent>();
    Debug.Log($"[{GetType().Name}] Tick {time.currentTick}");
    // ... rest of system
}
```

### Method 2: Unity Profiler
- Window â†’ Analysis â†’ Profiler
- Look for your system names in order

### Method 3: ECS System Inspector
- Window â†’ DOTS â†’ Systems
- Shows real-time system execution

## Common Patterns

### Producer-Consumer
```
SpawnerSystem â†’ DamageSystem â†’ HealthSystem â†’ DestroySystem
(produces)      (consumes)      (consumes)     (consumes)
```

### Modifier Chain
```
BaseVelocity â†’ +Gravity â†’ +Wind â†’ +Boost â†’ FinalMovement
```

### Event Processing
```
CollisionDetection â†’ CollisionEvents â†’ DamageEvents â†’ SoundEvents
(creates)            (processes)        (creates)       (consumes)
```